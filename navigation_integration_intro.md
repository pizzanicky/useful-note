# 室内定位导航功能集成方式说明

[http://www.tdlbs.com](http://www.tdlbs.com)

v1.0

本文内容针对Android和iOS两个平台的APP蓝牙定位导航功能开发，定位导航的所有功能均可支持纯离线使用，地图数据支持以离线数据包的形式更新。

本文非技术文档，不涉及SDK或模块集成方法的说明。如有需要，请参考相关文档

## 1 SDK集成 

### 1.1 简介

SDK即软件开发工具包，APP开发者可将SDK导入要开发的APP项目，调用SDK提供的API接口，实现APP所需要的功能。

SDK目前分为：定位SDK，地图SDK

### 1.2 优点

* 交付物是标准化的软件包（封装好的软件包，开发者导入到自己的工程中即可使用）
* 一般不需要定制开发（基本的常用功能均已经提供各类API，开发者可以自由调用）
* 不涉及客户APP的业务逻辑，业务开发由客户APP开发者进行（SDK提供的是基本的定位接口，如开启/停止定位，定位参数设置，路径规划等，开发者根据自己要实现的逻辑决定如何调用，我方提供必要的技术支持即可）

### 1.3 缺点

* 对客户APP开发者要求相对较高（视对方开发者能力，我方技术人员需提供一定支持，包括SDK文档，接口调用指导，在线支持，问题解答等等）
* 定位导航的体验和开发风险难控制（由于导航功能完全由客户APP实现，我方无法掌控其实现质量，客户往往也不愿开放其APP业务代码，所以出现问题比较难确定和解决，从而造成质量和进度难控制）

### 1.4 注意点

* 定位SDK和地图SDK没有绝对的依赖性，可以分开单独销售，分开销售时定位和地图可能需要和第三方的地图和定位分别配合使用，这里会涉及座标系匹配和转换的问题。我们的定位和地图座标系均为相对座标，以室内地图的左上角为原点，横向右为X轴正向，纵向下为Y轴正向
* SDK我方拥有知识产权，一般不交付源码

## 2 导航模块集成

### 2.1 简介

导航模块是在集成定位SDK和地图SDK的基础上进行一定定制开发的软件模块，该模块具备定位，路径规划，导航，POI搜索等基本功能，其他功能逻辑和界面风格均按照用户APP需求定制开发，开发完成后将模块交付用户，用户负责集成到其APP中，我方负责技术支持

### 2.2 优点

* 对客户APP开发者的要求相对较低（定位导航业务逻辑由我方实现，对方只负责把模块集成到自己的APP中）
* 导航功能开发实现风险较低（定位导航模块逻辑完全由我方实现，不夹杂用户APP其他逻辑，易于调试，维护，掌控开发进度）

### 2.3 缺点

* 我方前期定制开发工作量成本较大（需反复与客户确认需求定义和界面设计，其中存在需求变更的风险）
* 交付相对复杂（导航模块源码，设计文档，开发文档，集成说明，以及其他客户可能需要的材料）

### 2.4 注意点

* 交付的模块源码中包括标准SDK软件包和上层业务代码，不包括SDK源码
* 本集成方式适用于导航模块在客户APP中为独立模块的场景，如果APP和导航部分的功能之间有较多交互，推荐采用SDK集成的方式，否则开发和测试成本会大大增加

## 3 SDK基本功能

### 3.1 定位SDK

#### 3.1.1 能做什么

* 加载定位数据包
* 开启/停止定位服务（用户可根据业务需求，决定定位服务的启停）
* 设置定位周期，定位间隔等定位参数（用户可根据使用场景，灵活调整定位周期和间隔）
* 定位服务开启后，持续性异步返回定位结果（定位结果包含座标，建筑ID，楼层等信息）
* 定位服务出错时，返回错误原因（可辅助开发者进行出错诊断，用户提示等等）
* 支持调试模式，可记录运行日志，供用户诊断定位情况
* 可记录崩溃日志，便于诊断错误

#### 3.1.2 不能做什么

* 定位SDK本身不支持上报数据（定位SDK只提供基础定位服务，定位数据的处理方式建议放在业务层面实现，以增加灵活性，降低耦合）
* 定位SDK不包含惯性导航，传感器辅助等定位点优化策略（定位SDK输出原始定位结果，优化手段往往和用户场景相关，比如，车载定位终端和手持定位终端的位置优化策略完全不同。因此优化策略在应用层实现，我方可以提供常见场景的优化策略支持）

### 3.2 地图SDK

#### 3.2.1 能做什么

* 加载不同建筑的矢量地图数据
* 展现矢量地图
* 支持手势缩放
* 支持手势旋转
* 支持手动点选POI
* 提供缩放接口
* 提供旋转接口
* 提供楼层切换接口
* 提供POI查询接口
* 支持公共设施分类检索（卫生间，电梯，问询处，收银台等）
* 提供路径规划接口
* 提供导航路书
* 提供路径距离
* 提供POI名称，座标，ID
* 提供添加marker接口
* 支持地图自动旋转
* 支持AR模式

#### 